echo "üîç Running pre-push validations..."

# Get the current branch
current_branch=$(git rev-parse --abbrev-ref HEAD)

# Check branch protection rules
if [ "$current_branch" = "master" ]; then
  echo "‚ùå Direct push to master branch is not allowed!"
  echo "Please use pull requests to merge changes."
  exit 1
fi

# Additional validations for qa branch
if [ "$current_branch" = "qa" ]; then
  echo "‚ö†Ô∏è  Pushing to QA branch. Make sure this is from develop branch merge."
  
  # Check if the latest commit is a merge from develop
  latest_commit_msg=$(git log -1 --pretty=%B)
  if [[ ! "$latest_commit_msg" =~ ^Merge.*develop ]]; then
    echo "‚ùå QA branch should only receive merges from develop branch!"
    echo "Current commit: $latest_commit_msg"
    exit 1
  fi
fi

echo "‚úÖ Pre-push validations passed!"
